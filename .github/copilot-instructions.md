# Copilot Instructions for Memory Mirror

## Project overview

Memory Mirror is a React/Vite single-page application built on the [Base44](https://base44.com) platform.  It is a dementia-care companion app that provides:

- AI-powered chat companion for people with dementia (`chatWithAI`, `nightModeChat`)
- Family portal, caregiver dashboard, and care team management
- Smart-home control and mood-based device automation
- Night-watch monitoring, emergency alert detection, and caregiver reports
- Music therapy, photo/video library, and personalised story generation
- Voice cloning, offline-capable mode, and TV/phone/security specialist views

The app uses **hash-based routing** (`HashRouter`) and lazy-loads every page component via a central `src/pages.config.js` registry.

Backend logic lives entirely in the `functions/` directory as Deno edge functions deployed on Base44.  See `docs/api.md` for the full API reference.

---

## Tech stack

| Layer | Technology |
|---|---|
| UI framework | React 18 + JSX (no TypeScript in src/) |
| Build tool | Vite 6 |
| Routing | react-router-dom v6 (HashRouter) |
| Styling | Tailwind CSS v3 + shadcn/ui (Radix UI primitives) |
| Data fetching | @tanstack/react-query v5 + @base44/sdk |
| Animation | framer-motion |
| Forms | react-hook-form + zod |
| Charts | recharts |
| E2E tests | Playwright |
| Linting | ESLint 9 (flat config) |

---

## Repository layout

```
src/
  pages/          # One file per route (e.g. CaregiverDashboard.jsx)
  components/     # Shared UI components
    ui/           # Auto-generated shadcn/ui components — do not edit manually
  lib/            # Utilities, hooks, AuthContext, query-client, etc.
  hooks/          # Custom React hooks
  api/            # Base44 SDK entity helpers
  pages.config.js # Central route ↔ component mapping
  App.jsx         # Root app with AuthProvider + QueryClientProvider + Router
  Layout.jsx      # Persistent shell rendered around every page

functions/        # Deno edge functions (Base44 serverless backend)
docs/api.md       # API reference for all functions
e2e/              # Playwright end-to-end tests
```

---

## Development commands

```bash
# Install dependencies
npm install

# Start dev server (requires .env.local — see README)
npm run dev

# Production build
npm run build

# Lint (quiet — errors only)
npm run lint

# Lint and auto-fix
npm run lint:fix

# Type-check JS files with JSDoc via tsconfig
npm run typecheck

# Run E2E tests (headless) — requires a running dev server
npm run test:e2e

# Run E2E tests with Playwright UI
npm run test:e2e:ui
```

### Environment variables

Create `.env.local` at the repo root:

```
VITE_BASE44_APP_ID=<your_app_id>
VITE_BASE44_APP_BASE_URL=<your_backend_url>
```

---

## Code conventions

- **JavaScript only** — `src/` uses `.jsx` files with no TypeScript annotations.  `jsconfig.json` and `tsc` are used purely for type checking via JSDoc.
- **No React import needed** — `react/react-in-jsx-scope` is disabled; do not add `import React from 'react'`.
- **Remove unused imports** — ESLint enforces `unused-imports/no-unused-imports` as an error.  Always clean up imports.
- **Prop-types are off** — do not add PropTypes; rely on runtime and JSDoc types where needed.
- **shadcn/ui components** live in `src/components/ui/` and are generated by the shadcn CLI.  Edit them only when absolutely necessary, and prefer composing them rather than modifying them.
- **Tailwind for styling** — use Tailwind utility classes.  Avoid inline `style` props unless Tailwind cannot express the style (e.g. dynamic CSS variables).
- **Path aliases** — `@/` maps to `src/`.  Always use `@/` imports inside `src/`; never use relative `../../` paths that cross directory boundaries.
- **Routing** — add new pages to `src/pages.config.js`.  Do not add `<Route>` entries directly in `App.jsx` except for the two special-case static routes (`/privacy`, `/support`).
- **API calls** — use the Base44 SDK entity helpers from `src/api/` and `@base44/sdk`.  Do not call `fetch` directly for app data.

---

## Testing

End-to-end tests use **Playwright** and live in `e2e/`.  The `landing.spec.js` smoke test verifies that each feature card on the Landing page navigates to the correct hash route.

Before running `npm run test:e2e`, ensure:
1. `.env.local` is configured.
2. The dev server is running (`npm run dev`) or configure `webServer` in `playwright.config.js`.

There is no unit-test framework configured; new logic should be covered by E2E tests or manual verification.

---

## Key patterns

### Adding a new page

1. Create `src/pages/MyNewPage.jsx` exporting a default React component.
2. Register it in `src/pages.config.js` under the `Pages` map with the desired URL path as the key.
3. Optionally add a navigation entry in `src/Layout.jsx`.

### Adding a new API function

1. Create `functions/myNewFunction.js` following the pattern of existing functions (export a default `async (req, context) => {}` handler).
2. Document it in `docs/api.md`.

### Using shadcn/ui components

```bash
npx shadcn@latest add <component-name>
```

This writes to `src/components/ui/` automatically.

### Framer Motion animations

Wrap elements with `motion.div` (or similar) from `framer-motion`.  Keep animations subtle and accessible — use `prefers-reduced-motion` media query checks where appropriate.
